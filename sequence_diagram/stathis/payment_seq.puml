@startuml
actor "Ενοικιαστής" as Renter
participant "Σύστημα" as System
database "Βάση Δεδομένων" as DB
participant "API Τράπεζας" as BankAPI

Renter -> System: 1. Επιλογή προβολής καλαθιού
System -> Renter: 2. Μεταβίβαση στο καλάθι αγορών
System -> Renter: 3. Ζήτηση διεύθυνσης

alt #3: Ο ενοικιαστής αλλάζει γνώμη (από βήμα 4)
Renter -> System: 3.3.1 Επιλογή επιστροφής
System -> Renter: 3.3.2 Μεταβίβαση στην Αρχική σελίδα
else Happy Path (Συνέχεια)
Renter -> System: 4. Συμπλήρωση διεύθυνσης και αριθμού κουπονιού

alt #4: Μη έγκυρο κουπόνι (από βήμα 5)
System -> DB: 3.4.1 Έλεγχος στοιχείων κουπονιού
DB --> System: 3.4.1 Κωδικός κουπονιού δεν είναι έγκυρος
System -> Renter: 3.4.2 Ενημέρωση ότι το κουπόνι δεν είναι έγκυρο
Renter -> System: 3.4.3 Εισαγωγή νέου κωδικού κουπονιού
note right of Renter: Επιστροφή στο βήμα 5 της βασικής ροής (3.4.4)
System -> DB: Έλεγχος στοιχείων κουπονιού
else Happy Path (Έγκυρο κουπόνι)
System -> DB: 5. Έλεγχος στοιχείων κουπονιού
DB --> System: Κωδικός κουπονιού είναι έγκυρος
System -> System: 6. Υπολογισμός συνολικού ποσού (ΦΠΑ, έξοδα αποστολής)
System -> Renter: 6. Εμφάνιση συνολικού ποσού

alt #3: Ο ενοικιαστής αλλάζει γνώμη (από βήμα 7)
Renter -> System: 3.3.1 Επιλογή επιστροφής
System -> Renter: 3.3.2 Μεταβίβαση στην Αρχική σελίδα
else Happy Path (Συνέχεια)
Renter -> System: 7. Επιλογή συνέχειας προς πληρωμή
System -> Renter: 8. Μεταβίβαση στην πληρωμή και εμφάνιση επιλογών

alt #3: Ο ενοικιαστής αλλάζει γνώμη (από βήμα 9)
Renter -> System: 3.3.1 Επιλογή επιστροφής
System -> Renter: 3.3.2 Μεταβίβαση στην Αρχική σελίδα
else Happy Path (Συνέχεια)
Renter -> System: 9. Επιλογή τρόπου πληρωμής
System -> System: 10. Καταγραφή τρόπου πληρωμής
System -> Renter: 11. Ζήτηση συμπλήρωσης στοιχείων κάρτας

alt #3: Ο ενοικιαστής αλλάζει γνώμη (από βήμα 12)
Renter -> System: 3.3.1 Επιλογή επιστροφής
System -> Renter: 3.3.2 Μεταβίβαση στην Αρχική σελίδα
else Happy Path (Συνέχεια)
Renter -> System: 12. Συμπλήρωση στοιχείων και επιλογή ολοκλήρωσης
System -> System: 13. Κρυπτογράφηση στοιχείων πληρωμής
System -> BankAPI: 14. Αίτημα επικύρωσης με στοιχεία συναλλαγής

alt #1: Αποτυχία επικύρωσης στοιχείων (από βήμα 14/15)
BankAPI --> System: Αποτέλεσμα επικύρωσης (Αποτυχία)
System -> System: 3.1.1 Καταγραφή αδυναμίας επικύρωσης
System -> Renter: 3.1.2 Ενημέρωση να διορθώσει τα στοιχεία
note right of Renter: Επιστροφή στο βήμα 12 της βασικής ροής (3.1.3)
Renter -> System: Συμπλήρωση στοιχείων και επιλογή ολοκλήρωσης
System -> System: Κρυπτογράφηση στοιχείων πληρωμής
System -> BankAPI: Αίτημα επικύρωσης με στοιχεία συναλλαγής

alt #2: Ανεπαρκές Υπόλοιπο (από βήμα 14/15)
BankAPI --> System: Αποτέλεσμα επικύρωσης (Ανεπαρκές Υπόλοιπο)
System -> System: 3.2.1 Καταγραφή αδυναμίας κράτησης
System -> Renter: 3.2.2 Μήνυμα για χρήση άλλης κάρτας/μεθόδου
note right of Renter: Επιστροφή στο βήμα 9 της βασικής ροής (3.2.3)
Renter -> System: Επιλογή τρόπου πληρωμής
System -> System: Καταγραφή τρόπου πληρωμής
System -> Renter: Ζήτηση συμπλήρωσης στοιχείων κάρτας
Renter -> System: Συμπλήρωση στοιχείων και επιλογή ολοκλήρωσης
System -> System: Κρυπτογράφηση στοιχείων πληρωμής
System -> BankAPI: Αίτημα επικύρωσης με στοιχεία συναλλαγής
else Happy Path (Επιτυχία επικύρωσης)
BankAPI --> System: Αποτέλεσμα επικύρωσης (Επιτυχία)
System -> DB: 15. Καταγραφή ολοκλήρωσης πληρωμής
DB --> System: Επιβεβαίωση καταγραφής
System -> Renter: 16. Αποστολή απόδειξης πληρωμής
System -> DB: 17. Αλλαγή κατάστασης αγγελίας σε μη διαθέσιμη
DB --> System: Επιβεβαίωση αλλαγής κατάστασης
System -> Renter: 18. Μεταβίβαση στην Αρχική Οθόνη
end alt
end alt
end alt
end alt
end alt
end alt

@enduml
